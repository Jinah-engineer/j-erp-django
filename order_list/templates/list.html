{# ---------- 박진아 작업 ---------- #}
{% extends "base.html" %}
{% load static %}


{% block body %}

    <div class="splash active">
        <div class="splash-icon"></div>
    </div>

    <!-- *** 사이드 내비게이션 바 -->
    {% include 'navigation.html' %}

    <div class="main">

        <!-- *** 상위 내비게이션 바 *** -->
        {% include 'top-navigation.html' %}

        <main class="content">
            <div class="container-fluid">

                <div class="header">
                    <h1 class="header-title">
                        주문 목록
                    </h1>
                    <p class="header-subtitle">경로 작성하기</p>
                </div>

                <!-- *** 검색 바 *** -->
                {% include 'search_bar.html' %}


                <!-- *** 날짜 보기 / 선택 *** -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="row col-12 col-xl-6">
                                        <div class="form-group" style="margin: 1rem;">
                                            <label class="form-label">시작일</label>
                                            <div class="input-group date" id="datetimepicker-date" data-target-input="nearest">
                                                <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker-date" />
                                                <div class="input-group-append" data-target="#datetimepicker-date" data-toggle="datetimepicker">
                                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group" style="margin: 1rem;">
                                            <label class="form-label">종료일</label>
                                            <div class="input-group date" id="datetimepicker-date2" data-target-input="nearest">
                                                <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker-date2" />
                                                <div class="input-group-append" data-target="#datetimepicker-date2" data-toggle="datetimepicker">
                                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <!-- *** 버튼 바 *** -->
                    <style>
                        .card {
                            margin: 0 auto; /* Added */
                            float: none; /* Added */
                            margin-bottom: 10px; /* Added */
                        }
                    </style>

                    <div class="col-12">
                        <div class="card" style="height: 50px;">
                            <div class="card-body">
                                <div class="row">
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success">주문 목록 인쇄</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success">Excel 업로드</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success">Excel 다운로드</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success">개별 주문장 출력</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success">주문 수정</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button class="btn btn-success">주문 삭제</button>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center mr-auto" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                            상태변경
                                        </button>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="#">제작완료</a>
                                            <a class="dropdown-item" href="#">출고완료</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">출고보류</a>
                                            <a class="dropdown-item" href="#">출고취소</a>
                                            <a class="dropdown-item" href="#">기타</a>
                                        </div>
                                    </div>
                                    <div class="btn-group btn-group mb-4 align-items-center" role="group" style="padding: 0 2px;">
                                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                            정렬
                                        </button>
                                        <div class="dropdown-menu">
                                            <a class="dropdown-item" href="#">10개씩</a>
                                            <a class="dropdown-item" href="#">50개씩</a>
                                            <a class="dropdown-item" href="#">100개씩</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="col-12 d-flex">
                        <div class="card flex-fill">
                            <div class="card-header">
                                <div class="card-actions float-right">
                                    <a href="#" class="mr-1">
                                        <i class="align-middle" data-feather="refresh-cw"></i>
                                    </a>
                                    <div class="d-inline-block dropdown show">
                                        <a href="#" data-toggle="dropdown" data-display="static">
                                            <i class="align-middle" data-feather="more-vertical"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right">
                                            <a class="dropdown-item" href="#">Action</a>
                                            <a class="dropdown-item" href="#">Another action</a>
                                            <a class="dropdown-item" href="#">Something else here</a>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- *** Bootstrap 테이블 *** -->
                            <div class="col-12" style="padding: 0">
                                <div class="card w-100" style="">
                                    <table class="table table-bordered table-responsive table-sm"
                                           id="bootstrap-table">
                                        <thead>
                                        <tr style="font-family: 'NanumSquareL'" onmousedown="return false" onselect="return false">
                                            <th style="width:25%">pno</th>
                                            <th style="width:40%;">
                                                주문 No.
                                                {#                                                <i class="align-middle mr-2 fas fa-fw fa-sort-down"></i>#}
                                            </th>
                                            <th style="width:25%">주문일자</th>
                                            <th class="d-none d-md-table-cell" style="width:25%">진행상태</th>
                                            <th>고객명</th>
                                            <th>품목</th>
                                            <th>사이즈</th>
                                            <th>시트</th>
                                            <th>필링</th>
                                            <th>포장</th>
                                            <th>문구</th>
                                            <th>수량</th>
                                            <th>금액</th>
                                            <th>주문경로</th>
                                            <th>결제방법</th>
                                            <th>결제여부</th>
                                            <th>수령인</th>
                                            <th>연락처</th>
                                            <th>수령방법</th>
                                            <th>수령주소</th>
                                            <th>상세주소</th>
                                            <th>납품일자</th>
                                            <th>납품시간</th>
                                            <th>주문메모</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for order in orderDetail %}
                                            <tr id="order{{ order.order_no }}">
                                                <td>{{ order.pno }}</td>
                                                {#                                                <td hidden="hidden"><input hidden="hidden" name="pno" type="text" value="{{ order.pno }}"></td>#}
                                                <td><a href="https://www.naver.com/">{{ order.order_no }}</a></td>
                                                <td>{{ order.order_date }}</td>
                                                <td><span class="badge badge-success">{{ order.state }}</span></td>
                                                <td>{{ order.customer }}</td>
                                                <td>{{ order.product_name }}</td>
                                                <td>{{ order.size_option_name }}</td>
                                                <td>{{ order.sheet_option_name }}</td>
                                                <td>{{ order.filling_option_name }}</td>
                                                <td>{{ order.boxing_option_name }}</td>
                                                <td>{{ order.phrase }}</td>
                                                <td>{{ order.count }}</td>
                                                <td>{{ order.total_price }}</td>
                                                <td>{{ order.order_type_name }}</td>
                                                <td>{{ order.pay_type_name }}</td>
                                                <td>{{ order.pay_check }}</td>
                                                <td>{{ order.recipient }}</td>
                                                <td>{{ order.recipient_phone }}</td>
                                                <td>{{ order.delivery_option_name }}</td>
                                                <td>{{ order.address1 }}</td>
                                                <td>{{ order.address2 }}</td>
                                                <td>{{ order.receipt_date }}</td>
                                                <td>{{ order.receipt_hour }}</td>
                                                <td>{{ order.memo }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- *** 주문 상세 모달 *** -->
        {% include 'orderlist/detail.html' %}



        <!-- *** footer *** -->
        {% include 'footer.html' %}

    </div>

    </div>

    <svg width="0" height="0" style="position:absolute">
        <defs>
            <symbol viewBox="0 0 512 512" id="ion-ios-pulse-strong">
                <path
                        d="M448 273.001c-21.27 0-39.296 13.999-45.596 32.999h-38.857l-28.361-85.417a15.999 15.999 0 0 0-15.183-10.956c-.112 0-.224 0-.335.004a15.997 15.997 0 0 0-15.049 11.588l-44.484 155.262-52.353-314.108C206.535 54.893 200.333 48 192 48s-13.693 5.776-15.525 13.135L115.496 306H16v31.999h112c7.348 0 13.75-5.003 15.525-12.134l45.368-182.177 51.324 307.94c1.229 7.377 7.397 11.92 14.864 12.344.308.018.614.028.919.028 7.097 0 13.406-3.701 15.381-10.594l49.744-173.617 15.689 47.252A16.001 16.001 0 0 0 352 337.999h51.108C409.973 355.999 427.477 369 448 369c26.511 0 48-22.492 48-49 0-26.509-21.489-46.999-48-46.999z">
                </path>
            </symbol>
        </defs>
    </svg>

    {% block stylesheets %}
        <style>
            #bootstrap-table {
                overflow-x: scroll;
                overflow-y: scroll;
            {#max-width: 100%;#}
                display: block;
                white-space: nowrap;
            }
            th, td{ text-align: center; }

            th {
                font-weight: bold;
            }
            .dataTables_length label {
            {#padding-left: 20px;#}
            }
            .sorting, .sorting_asc {
                font-family: 'NanumSquareB';
            }
            body {
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
        </style>
    {% endblock stylesheets %}
{% endblock %}

{% block javascript %}

    <script src="{% static 'dist/js/app.js' %}"></script>
    <script src="{% static 'dist/js/settings.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>


    <!-- *** 페이지네이션 *** -->
    <script>
        window.onload = function() {
            $(function() {
                $('#bootstrap-table').DataTable({
                    pageLength: 25,
                    dom: 'Bfrtip',
                    buttons: [
                        {
                            extend: 'excelHtml5',
                            text: 'Excel 다운로드<i class="align-middle mr-2 far fa-fw fa-file-excel"></i>',
                            titleAttr: 'Excel'
                        }
                    ],
                    ordering: false,
                    // columnDefs: {
                    //     className: "dt-center", targets: "_all"
                    // },
                    // lengthChange: false,
                    {#bFilter: true,#}
                    // autoWidth: true,
                    // autoAdjustHeight: true;
                    // autoplay: true,
                    // lengthAdjust: false,
                    // scrollY: "60vh",
                    // sScrollX: "100%",
                    // sScrollXInner: "50%",
                    // scrollCollapse: false,
                    // paging: true,
                    // responsive: true,
                });
                // $('#datatables-dashboard-products').closest('.dataTables_scrollBody').css('max-height', '100%');
                $('#bootstrap-table').DataTable().draw();

                var table = $('#bootstrap-table').DataTable();

                // 데이터 row 선택하기 (multiple rows selected)
                $('#bootstrap-table tbody').on('click', 'tr', function () {
                    if ($(this).hasClass('selected')) {
                        $(this).removeClass('selected');
                        // $(this).toggleClass('selected');
                        $(this).css("background-color", "#F5E6C4");
                    }
                    else {
                        // table.$('tr.selected').removeClass('selected');
                        // $(this).addClass('selected');
                        $(this).toggleClass('selected');
                        $(this).css("background-color", "transparent");
                    }
                });
            });

            // DateTimePicker 원본 API
            $(function() {
                // Daterangepicker
                $("input[name=\"daterange\"]").daterangepicker({
                    opens: "left"
                });
                $("input[name=\"datetimes\"]").daterangepicker({
                    timePicker: true,
                    opens: "left",
                    startDate: moment().startOf("hour"),
                    endDate: moment().startOf("hour").add(32, "hour"),
                    locale: {
                        format: "M/DD"
                    }
                });
                $("input[name=\"datesingle\"]").daterangepicker({
                    singleDatePicker: true,
                    showDropdowns: true
                });
                var start = moment().subtract(29, "days");
                var end = moment();

                function cb(start, end) {
                    $("#reportrange span").html(start.format("MMMM D, YYYY") + " - " + end.format("MMMM D, YYYY"));
                }

                $("#reportrange").daterangepicker({
                    startDate: start,
                    endDate: end,
                    ranges: {
                        "Today": [moment(), moment()],
                        "Yesterday": [moment().subtract(1, "days"), moment().subtract(1, "days")],
                        "Last 7 Days": [moment().subtract(6, "days"), moment()],
                        "Last 30 Days": [moment().subtract(29, "days"), moment()],
                        "This Month": [moment().startOf("month"), moment().endOf("month")],
                        "Last Month": [moment().subtract(1, "month").startOf("month"), moment().subtract(1, "month").endOf("month")]
                    }
                }, cb);
                cb(start, end);

                // Datetimepicker
                $('#datetimepicker-date').datetimepicker({
                    format: 'L'
                });
                $('#datetimepicker-date2').datetimepicker({
                    format: 'L'
                });
            });
        }
    </script>

    <script>
        $(function () {
            // 해당 주문번호를 클릭하면, modal open (해당 주문번호에 맞는 상세화면이 뜬다)
            // 해당 주문번호의 id -> order + pno
            $('tr[id^="order{{ order.pno }}"] a').on('click', function () {
                alert('click!!!!!')

            });

        })
    </script>

{% endblock javascript %}

